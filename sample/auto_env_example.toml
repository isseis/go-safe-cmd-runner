# Automatic Internal Variables Example Configuration
#
# This configuration demonstrates the use of automatically generated
# internal variables (%{__runner_datetime} and %{__runner_pid}) for
# practical use cases like timestamped backups and PID-based locking.

version = "1.0"

[global]
timeout = 3600
log_level = "info"
env_allowed = ["PATH", "HOME", "USER"]

[[groups]]
name = "backup_operations"
description = "Backup operations with automatic timestamping"

# Example 1: Timestamp-based backup file naming
[[groups.commands]]
name = "timestamp_backup"
description = "Create a backup file with timestamp"
cmd = "/usr/bin/tar"
args = [
    "czf",
    "/tmp/backup/data-%{__runner_datetime}.tar.gz",
    "/tmp/data"
]
# Output example: /tmp/backup/data-20251005143022.123.tar.gz

# Example 2: Database dump with timestamp
[[groups.commands]]
name = "db_backup"
description = "Database backup with timestamp"
cmd = "/bin/sh"
args = [
    "-c",
    "echo 'Database dump at %{__runner_datetime}' > /tmp/backup/db-%{__runner_datetime}.sql"
]
# Output example: /tmp/backup/db-20251005143022.123.sql

[[groups]]
name = "logging_operations"
description = "Logging with execution metadata"

# Example 3: Execution logging with timestamp and PID
[[groups.commands]]
name = "log_execution"
description = "Log execution time and PID"
cmd = "/bin/sh"
args = [
    "-c",
    "echo 'Executed at %{__runner_datetime} by PID %{__runner_pid}' >> /tmp/executions.log"
]
# Output example: Executed at 20251005143022.123 by PID 12345

# Example 4: Combined timestamp and PID in filename
[[groups.commands]]
name = "combined_metadata"
description = "Use both timestamp and PID in filename"
cmd = "/bin/sh"
args = [
    "-c",
    "echo 'Report content' > /tmp/reports/report-%{__runner_datetime}-%{__runner_pid}.txt"
]
# Output example: /tmp/reports/report-20251005143022.123-12345.txt

[[groups]]
name = "lock_file_operations"
description = "PID-based lock file management"

# Example 5: Create PID-based lock file
[[groups.commands]]
name = "create_lock"
description = "Create a PID-based lock file"
cmd = "/bin/sh"
args = [
    "-c",
    "echo %{__runner_pid} > /tmp/locks/myapp-%{__runner_pid}.lock"
]
# Output example: /tmp/locks/myapp-12345.lock (contains: 12345)

# Example 6: Check lock file existence
[[groups.commands]]
name = "check_lock"
description = "Display lock file path"
cmd = "/bin/sh"
args = [
    "-c",
    "echo 'Lock file: /tmp/locks/myapp-%{__runner_pid}.lock'"
]
# Output example: Lock file: /tmp/locks/myapp-12345.lock

[[groups]]
name = "nested_variables"
description = "Using auto variables with user-defined variables"

# Example 7: Combining auto and user-defined variables
[[groups.commands]]
name = "nested_auto_vars"
description = "Combine automatic and custom internal variables"
cmd = "/bin/sh"
args = [
    "-c",
    "echo 'Backup %{backup_name} created at %{backup_path}'"
]
vars = [
    "backup_name=database",
    "backup_path=/tmp/backup/%{backup_name}-%{__runner_datetime}.tar.gz"
]
# Output example: Backup database created at /tmp/backup/database-20251005143022.123.tar.gz

[[groups]]
name = "group_consistency"
description = "Demonstrating consistent auto variables across group commands"

# Both commands in this group will use the same __runner_datetime and __runner_pid
[[groups.commands]]
name = "backup_db_consistent"
description = "Database backup (group consistency example)"
cmd = "/bin/sh"
args = [
    "-c",
    "echo 'DB backup: /tmp/backup/db-%{__runner_datetime}.sql'"
]

[[groups.commands]]
name = "backup_files_consistent"
description = "File backup (group consistency example)"
cmd = "/bin/sh"
args = [
    "-c",
    "echo 'Files backup: /tmp/backup/files-%{__runner_datetime}.tar.gz'"
]
# Both commands will show the same timestamp

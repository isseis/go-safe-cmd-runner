# Variable expansion test configuration
# Tests cmd and args variable expansion with %{VAR} format
version = "1.0"

[global]
timeout = 30
workdir = "/tmp/var-expansion-test"
log_level = "debug"
skip_standard_paths = true
env_allowlist = [
    "PATH",
    "HOME",
    "USER",
]

# Group 1: Basic variable expansion in cmd
[[groups]]
name = "cmd_expansion_basic"
description = "Test basic variable expansion in cmd field"
priority = 1

[[groups.commands]]
name = "echo_with_var_cmd"
description = "Use echo command via path variable"
cmd = "%{path}"
args = ["Command path from path variable"]
vars = ["path=/bin/echo"]

# Group 2: Basic variable expansion in args
[[groups]]
name = "args_expansion_basic"
description = "Test basic variable expansion in args field"
priority = 2

[[groups.commands]]
name = "echo_with_var_args"
description = "Echo message with variable in args"
cmd = "echo"
args = ["Hello, %{user}!"]
vars = ["user=TestUser"]

[[groups.commands]]
name = "echo_multiple_vars"
description = "Echo with multiple variables in args"
cmd = "echo"
args = ["Base: %{base_path}", "File: %{filename}.%{extension}"]
vars = [
    "base_path=/home/test",
    "filename=data",
    "extension=txt"
]

# Group 3: Combined cmd and args expansion
[[groups]]
name = "combined_expansion"
description = "Test variable expansion in both cmd and args"
priority = 3

[[groups.commands]]
name = "full_expansion_test"
description = "Expand variables in both cmd and args"
cmd = "%{path}"
args = ["Variable test: %{test_var}"]
vars = [
    "path=/bin/echo",
    "test_var=success"
]

# Group 4: Nested variable expansion
[[groups]]
name = "nested_expansion"
description = "Test nested variable references"
priority = 4

[[groups.commands]]
name = "nested_vars"
description = "Use nested variable expansion"
cmd = "echo"
args = ["Nested: %{test_var}"]
vars = [
    "user=testuser",
    "test_var=%{user}_nested"
]

# Group 5: Escape sequence test
[[groups]]
name = "escape_test"
description = "Test backslash escape sequences"
priority = 5

[[groups.commands]]
name = "escaped_percent"
description = "Test escaped percent sign"
cmd = "echo"
args = ["Literal \\%{HOME} should not expand"]

[[groups.commands]]
name = "escaped_backslash"
description = "Test escaped backslash before variable"
cmd = "echo"
args = ["Path: \\\\%{home}"]
from_env = ["home=HOME"]

# Global and Group Environment Variables - Basic Example
#
# This sample demonstrates the basic usage of global.vars, groups[].vars, and env fields.
# It shows how to define internal variables and environment variables at different levels
# and how they are inherited and used.

version = "1.0"

[global]
# Global internal variables: available to all groups and commands for TOML expansion
vars = [
    "base_dir=/opt/myapp",
    "log_level=info",
    "config_file=/etc/myapp/config.yaml",
]

# Allow system environment variables
env_allowlist = ["HOME", "PATH", "USER"]

# Import system environment variables as internal variables
from_env = [
    "home=HOME",
    "user=USER"
]

# Verify critical files before execution
verify_files = ["%{base_dir}/verify.sh"]

# Skip standard path validation for system commands
skip_standard_paths = true

# Database group: demonstrates group-level internal variables
[[groups]]
name = "database"
description = "Database management tasks"

# Group-level internal variables: available to all commands in this group for TOML expansion
vars = [
    "db_host=localhost",
    "db_port=5432",
    "db_name=myapp_db",
    "db_data=%{base_dir}/db-data",  # References global.vars variable
]

[[groups.commands]]
name = "show_db_config"
description = "Display database configuration"
cmd = "/bin/echo"
args = [
    "Database: %{db_name} at %{db_host}:%{db_port}",
    "Data directory: %{db_data}",
]

[[groups.commands]]
name = "show_log_level"
description = "Display log level from global.vars"
cmd = "/bin/echo"
args = ["Log level: %{log_level}"]  # References global.vars variable

# Web server group: demonstrates variable override
[[groups]]
name = "web"
description = "Web server management tasks"

# Override global.vars LOG_LEVEL for this group
vars = [
    "log_level=debug",              # Overrides global.vars
    "web_dir=%{base_dir}/web",      # References global.vars
    "port=8080",                    # Group-specific variable
]

[[groups.commands]]
name = "show_web_config"
description = "Display web server configuration"
cmd = "/bin/echo"
args = [
    "Web directory: %{web_dir}",
    "Port: %{port}",
    "Log level: %{log_level}",  # Will show "debug" (overridden)
]

# System tools group: demonstrates system env variable import and PATH extension
[[groups]]
name = "tools"
description = "System utility tasks"

# Import and extend system PATH variable
from_env = ["system_path=PATH"]
vars = ["tool_dir=%{home}/tools"]  # References from_env variable 'home'
env = ["PATH=/opt/custom/bin:%{system_path}"]  # Extend PATH for child process

[[groups.commands]]
name = "show_path"
description = "Display extended PATH"
cmd = "/bin/sh"
args = ["-c", "echo Custom PATH: $PATH"]

[[groups.commands]]
name = "show_tool_dir"
description = "Display tool directory"
cmd = "/bin/echo"
args = ["Tool directory: %{tool_dir}"]

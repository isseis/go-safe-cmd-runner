# 第3章: ルートレベル設定

## 3.1 version

### 概要

`version` は設定ファイルのフォーマットバージョンを指定する必須パラメータです。設定ファイルの最上位(ルートレベル)に記述します。

### 文法

```toml
version = "バージョン文字列"
```

### パラメータの詳細

| 項目 | 内容 |
|-----|------|
| **型** | 文字列 (string) |
| **必須/オプション** | 必須 |
| **設定可能な階層** | ルートレベルのみ |
| **デフォルト値** | なし(必ず指定が必要) |
| **有効な値** | "1.0" (現在サポートされているバージョン) |

### 役割

- **互換性の保証**: 将来の設定ファイルフォーマットの変更に対応するため、バージョン情報を記録
- **検証**: 実行時に設定ファイルのバージョンをチェックし、互換性のない設定を検出
- **ドキュメント化**: 設定ファイルがどのバージョンの仕様に従っているかを明示

### 設定例

#### 基本的な設定

```toml
version = "1.0"

[global]
timeout = 60

[[groups]]
name = "example"

[[groups.commands]]
name = "test"
cmd = "echo"
args = ["Hello"]
```

この例では、設定ファイルのバージョンを "1.0" と指定しています。

### 注意事項

#### 1. 必ず最初に記述

`version` は設定ファイルの最初に記述することを推奨します。他のセクションより前に配置することで、可読性が向上します。

```toml
# 推奨: バージョンを最初に記述
version = "1.0"

[global]
timeout = 60
```

```toml
# 非推奨: バージョンが後に記述されている
[global]
timeout = 60

version = "1.0"  # 動作はするが、可読性が低い
```

#### 2. バージョン文字列の形式

現在サポートされているバージョンは "1.0" のみです。将来的に新しいバージョンがリリースされた場合、互換性のない変更が含まれる可能性があります。

```toml
# 正しい
version = "1.0"

# 誤り: サポートされていないバージョン
version = "2.0"  # エラーになる可能性があります
```

#### 3. バージョンの省略は不可

`version` パラメータは必須です。省略するとエラーになります。

```toml
# 誤り: バージョンが省略されている
[global]
timeout = 60

[[groups]]
name = "example"
# ... (エラー: version が指定されていません)
```

### よくある質問

#### Q1: なぜバージョン指定が必須なのですか?

A: 将来の設定ファイル形式の変更に対応するためです。バージョン情報により、古い設定ファイルと新しい設定ファイルを区別し、適切に処理できます。

#### Q2: バージョン番号を間違えるとどうなりますか?

A: サポートされていないバージョンを指定すると、go-safe-cmd-runner が設定ファイルの読み込みを拒否し、エラーメッセージを表示します。

#### Q3: バージョン "1.0" では何がサポートされていますか?

A: 本ドキュメントで説明する全ての機能がバージョン "1.0" でサポートされています:
- グローバル設定
- グループとコマンドの定義
- 環境変数管理
- ファイル検証
- 権限管理
- 変数展開
- 出力キャプチャ

### ベストプラクティス

1. **常に現在の最新バージョンを使用**: 新しい機能を利用するため、最新のバージョン番号を指定
2. **設定ファイルの先頭に配置**: 可読性とメンテナンス性の向上
3. **コメントで記録**: 設定ファイル作成日やバージョンの理由をコメントで記録

```toml
# Configuration file for go-safe-cmd-runner
# Created: 2025-01-15
# Version 1.0 format
version = "1.0"

[global]
# ... 以下、設定が続く
```

## 次のステップ

次章では、グローバルレベルの設定(`[global]`)について詳しく解説します。タイムアウト、作業ディレクトリ、環境変数管理など、全体に影響する重要な設定を学びます。

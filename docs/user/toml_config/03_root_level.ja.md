# 第3章: ルートレベル設定

## 3.1 version

### 概要

`version` は設定ファイルのフォーマットバージョンを指定するオプションパラメータです。設定ファイルの最上位(ルートレベル)に記述します。

### 文法

```toml
version = "バージョン文字列"
```

### パラメータの詳細

| 項目 | 内容 |
|-----|------|
| **型** | 文字列 (string) |
| **必須/オプション** | オプション |
| **設定可能な階層** | ルートレベルのみ |
| **デフォルト値** | なし(省略可能) |
| **有効な値** | "1.0" |

### 役割

- **互換性の保証**: 将来の設定ファイルフォーマットの変更に対応するため、バージョン情報を記録
- **検証**: 実行時に設定ファイルのバージョンをチェックし、互換性のない設定を検出
- **ドキュメント化**: 設定ファイルがどのバージョンの仕様に従っているかを明示

### 設定例

#### 基本的な設定

```toml
version = "1.0"

[global]
timeout = 60

[[groups]]
name = "example"

[[groups.commands]]
name = "test"
cmd = "echo"
args = ["Hello"]
```

この例では、設定ファイルのバージョンを "1.0" と指定しています。

### 注意事項

#### 1. 必ず最初に記述

`version` は設定ファイルの最初に記述することを推奨します。他のセクションより前に配置することで、可読性が向上します。

```toml
# 推奨: バージョンを最初に記述
version = "1.0"

[global]
timeout = 60
```

```toml
# 非推奨: バージョンが後に記述されている
[global]
timeout = 60

version = "1.0"  # 動作はするが、可読性が低い
```

#### 2. バージョン文字列の形式

現在サポートされているバージョンは "1.0" のみです。将来的に新しいバージョンがリリースされた場合、互換性のない変更が含まれる可能性があります。

```toml
# 正しい
version = "1.0"

# 誤り: サポートされていないバージョン
version = "2.0"  # エラーになる可能性があります
```

#### 3. バージョンの省略

`version` パラメータは省略可能です。現在の実装では、バージョン文字列は記録されますが、検証は行われません。

```toml
# バージョンを省略しても動作する
[global]
timeout = 60

[[groups]]
name = "example"

[[groups.commands]]
name = "test"
cmd = "echo"
args = ["Hello"]
```

### よくある質問

#### Q1: なぜバージョンを指定するのですか?

A: 将来の設定ファイル形式の変更に対応するためです。現在はバージョンチェックが実装されていませんが、将来的にバージョン情報を使って古い設定ファイルと新しい設定ファイルを区別する可能性があります。

#### Q2: バージョンを省略しても問題ありませんか?

A: 現在の実装では、バージョンを省略しても正常に動作します。ただし、将来の互換性のため、`version = "1.0"` を明示的に指定することを推奨します。

#### Q3: バージョン "1.0" では何がサポートされていますか?

A: 本ドキュメントで説明する全ての機能がバージョン "1.0" でサポートされています:
- グローバル設定
- グループとコマンドの定義
- 環境変数管理
- ファイル検証
- 権限管理
- 変数展開
- 出力キャプチャ

### ベストプラクティス

1. **常に現在の最新バージョンを使用**: 新しい機能を利用するため、最新のバージョン番号を指定
2. **設定ファイルの先頭に配置**: 可読性とメンテナンス性の向上
3. **コメントで記録**: 設定ファイル作成日やバージョンの理由をコメントで記録

```toml
# Configuration file for go-safe-cmd-runner
# Created: 2025-01-15
# Version 1.0 format
version = "1.0"

[global]
# ... 以下、設定が続く
```

## 次のステップ

次章では、グローバルレベルの設定(`[global]`)について詳しく解説します。タイムアウト、作業ディレクトリ、環境変数管理など、全体に影響する重要な設定を学びます。

# ãƒ†ã‚¹ãƒˆæ¨å¥¨äº‹é …: vars-envåˆ†é›¢ (Task 0033)

**ç›®çš„**: æ¤œè¨¼ã§ç‰¹å®šã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚®ãƒ£ãƒƒãƒ—ã«å¯¾å‡¦ã™ã‚‹ãŸã‚ã®è©³ç´°ãªæ¨å¥¨äº‹é …

---

## å„ªå…ˆåº¦ãƒãƒˆãƒªã‚¯ã‚¹

| å„ªå…ˆåº¦ | ãƒ†ã‚¹ãƒˆé ˜åŸŸ | ä»¶æ•° | è¦‹ç©å·¥æ•° | PRã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã¹ãã‹? |
|----------|-----------|-------|-------------|------------------|
| ğŸ”´ **ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«** | Allowlistå¼·åˆ¶ | 5ãƒ†ã‚¹ãƒˆ | 3-4æ™‚é–“ | **ã¯ã„** |
| ğŸ”´ **ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«** | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çµ±åˆ | 3ãƒ†ã‚¹ãƒˆ | 4-5æ™‚é–“ | **ã¯ã„** |
| ğŸ”´ **ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«** | ç’°å¢ƒå¤‰æ•°å„ªå…ˆé †ä½E2E | 4ãƒ†ã‚¹ãƒˆ | 3-4æ™‚é–“ | **ã¯ã„** |
| ğŸŸ¡ **é«˜** | ã‚³ãƒãƒ³ãƒ‰envå±•é–‹ | 5ãƒ†ã‚¹ãƒˆ | 2-3æ™‚é–“ | **æ¨å¥¨** |
| ğŸŸ¡ **é«˜** | Verify Fileså±•é–‹ | 8ãƒ†ã‚¹ãƒˆ | 2-3æ™‚é–“ | **æ¨å¥¨** |
| ğŸŸ¢ **ä¸­** | è‡ªå·±å‚ç…§ | 4ãƒ†ã‚¹ãƒˆ | 2-3æ™‚é–“ | **æ¤œè¨** |
| âš« **ä½** | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ | 9ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ | 2-3æ™‚é–“ | **ã„ã„ãˆ** |

**ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹åˆè¨ˆ**: 10-13æ™‚é–“
**é«˜å„ªå…ˆåº¦åˆè¨ˆ**: 4-6æ™‚é–“
**ä¸­å„ªå…ˆåº¦åˆè¨ˆ**: 2-3æ™‚é–“

---

## ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«å„ªå…ˆåº¦: Allowlistå¼·åˆ¶ãƒ†ã‚¹ãƒˆ

### ã‚®ãƒ£ãƒƒãƒ—åˆ†æ

**å‰Šé™¤ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«**: `internal/runner/config/allowlist_violation_test.go` (289è¡Œ)
**å‰Šé™¤ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆ**: 5ã¤ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ
**ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸**: âŒ **ãªã—**

### ãªãœã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‹

Allowlistå¼·åˆ¶ã¯ä»¥ä¸‹ã‚’è¡Œã†**ã‚³ã‚¢ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**:
- æ©Ÿå¯†ç’°å¢ƒå¤‰æ•°ã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢
- è¤‡æ•°ãƒ¬ãƒ™ãƒ«(globalã€groupã€command)ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’å¼·åˆ¶
- verify_filesãƒ‘ã‚¹ã‚’ä¸æ­£ãªå¤‰æ•°å‚ç…§ã‹ã‚‰ä¿è­·
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹(ç©ºã®allowlistã€ç¶™æ‰¿ã€ä¸Šæ›¸ã)ã‚’å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

**ã“ã‚Œã‚‰ã®ãƒ†ã‚¹ãƒˆãŒãªã„ã¨**:
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãŒæ¤œå‡ºã•ã‚Œãªã„
- Allowlistãƒã‚¤ãƒ‘ã‚¹è„†å¼±æ€§ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§
- æœ¬ç•ªç’°å¢ƒã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒãƒªã‚¹ã‚¯ã«ã•ã‚‰ã•ã‚Œã‚‹

### æ¨å¥¨ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆ1: `TestAllowlistViolation_Global`

**ç›®çš„**: globalã®from_envã§ã®allowlistå¼·åˆ¶ã‚’æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. è¨±å¯ã•ã‚ŒãŸå¤‰æ•°å‚ç…§ - æˆåŠŸã™ã¹ã
   from_env: [["SAFE_VAR", "HOME"]]
   env_allowlist: ["HOME", "USER"]
   æœŸå¾…: æˆåŠŸ

2. ç¦æ­¢ã•ã‚ŒãŸå¤‰æ•°å‚ç…§ - å¤±æ•—ã™ã¹ã
   from_env: [["DANGER", "SECRET_KEY"]]
   env_allowlist: ["HOME", "USER"]
   æœŸå¾…: allowlisté•åãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å«ã‚€ã‚¨ãƒ©ãƒ¼

3. ç©ºã®allowlistã¯ã™ã¹ã¦ã‚’ãƒ–ãƒ­ãƒƒã‚¯ - å¤±æ•—ã™ã¹ã
   from_env: [["VAR", "HOME"]]
   env_allowlist: []
   æœŸå¾…: ã‚¨ãƒ©ãƒ¼

4. è¨±å¯ã•ã‚ŒãŸåå‰ã§æœªå®šç¾©ã®ã‚·ã‚¹ãƒ†ãƒ å¤‰æ•° - ç•°ãªã‚‹å¤±æ•—
   from_env: [["VAR", "NONEXISTENT"]]
   env_allowlist: ["NONEXISTENT"]
   æœŸå¾…: ã‚¨ãƒ©ãƒ¼(ã‚·ã‚¹ãƒ†ãƒ å¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„)

5. è¤‡æ•°ã®å‚ç…§ã€1ã¤ãŒç¦æ­¢ - å¤±æ•—ã™ã¹ã
   from_env: [["A", "HOME"], ["B", "SECRET"]]
   env_allowlist: ["HOME"]
   æœŸå¾…: 2ç•ªç›®ã®å‚ç…§ã§ã‚¨ãƒ©ãƒ¼
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `internal/runner/config/allowlist_test.go` (æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«)

**ä¾å­˜é–¢ä¿‚**: %{VAR}æ§‹æ–‡ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

**è¦‹ç©æ™‚é–“**: 45åˆ†

---

#### ãƒ†ã‚¹ãƒˆ2: `TestAllowlistViolation_Group`

**ç›®çš„**: ç¶™æ‰¿ã‚’ä¼´ã†groupã®from_envã§ã®allowlistå¼·åˆ¶ã‚’æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. globalã®allowlistã‚’ç¶™æ‰¿ - è¨±å¯
   group.from_env: [["VAR", "HOME"]]
   group.env_allowlist: nil (ç¶™æ‰¿)
   global.env_allowlist: ["HOME", "USER"]
   æœŸå¾…: æˆåŠŸ

2. globalã®allowlistã‚’ç¶™æ‰¿ - ç¦æ­¢
   group.from_env: [["VAR", "SECRET"]]
   group.env_allowlist: nil
   global.env_allowlist: ["HOME"]
   æœŸå¾…: ã‚¨ãƒ©ãƒ¼

3. globalã®allowlistã‚’ä¸Šæ›¸ã - ä»Šã¯è¨±å¯
   group.from_env: [["VAR", "SECRET"]]
   group.env_allowlist: ["SECRET"]
   global.env_allowlist: ["HOME"]
   æœŸå¾…: æˆåŠŸ

4. globalã®allowlistã‚’ä¸Šæ›¸ã - ä»Šã¯ç¦æ­¢
   group.from_env: [["VAR", "HOME"]]
   group.env_allowlist: ["SECRET"]
   global.env_allowlist: ["HOME", "SECRET"]
   æœŸå¾…: ã‚¨ãƒ©ãƒ¼

5. ç©ºã®groupã®allowlistã¯ã™ã¹ã¦ã‚’ãƒ–ãƒ­ãƒƒã‚¯
   group.from_env: [["VAR", "HOME"]]
   group.env_allowlist: []
   global.env_allowlist: ["HOME"]
   æœŸå¾…: ã‚¨ãƒ©ãƒ¼
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `internal/runner/config/allowlist_test.go`

**è¦‹ç©æ™‚é–“**: 1æ™‚é–“

---

#### ãƒ†ã‚¹ãƒˆ3: `TestAllowlistViolation_VerifyFiles`

**ç›®çš„**: verify_filesãƒ‘ã‚¹ã§ã®allowlistå¼·åˆ¶ã‚’æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. è¨±å¯ã•ã‚ŒãŸå¤‰æ•°ã‚’æŒã¤globalã®verify_files
   global.verify_files: ["/path/to/%{HOME}/file"]
   global.from_env: [["HOME", "HOME"]]
   global.env_allowlist: ["HOME"]
   æœŸå¾…: æˆåŠŸã€ãƒ‘ã‚¹ãŒæ­£ã—ãå±•é–‹ã•ã‚Œã‚‹

2. ç¦æ­¢ã•ã‚ŒãŸå¤‰æ•°ã‚’æŒã¤globalã®verify_files
   global.verify_files: ["/path/%{SECRET}/file"]
   global.from_env: [["SECRET", "SECRET_KEY"]]
   global.env_allowlist: ["HOME"]
   æœŸå¾…: ã‚¨ãƒ©ãƒ¼

3. ç¶™æ‰¿ã•ã‚ŒãŸallowlistã‚’æŒã¤groupã®verify_files
   group.verify_files: ["/path/%{VAR}/file"]
   group.from_env: [["VAR", "USER"]]
   group.env_allowlist: nil
   global.env_allowlist: ["USER"]
   æœŸå¾…: æˆåŠŸ

4. ä¸Šæ›¸ãã•ã‚ŒãŸallowlistã‚’æŒã¤groupã®verify_files
   group.verify_files: ["/path/%{VAR}/file"]
   group.from_env: [["VAR", "SECRET"]]
   group.env_allowlist: ["SECRET"]
   global.env_allowlist: ["HOME"]
   æœŸå¾…: æˆåŠŸ

5. è¤‡æ•°ã®ãƒ‘ã‚¹ã€1ã¤ã«ç¦æ­¢ã•ã‚ŒãŸå¤‰æ•°
   verify_files: ["/a/%{HOME}/f", "/b/%{SECRET}/f"]
   æœŸå¾…: 2ç•ªç›®ã®ãƒ‘ã‚¹ã§ã‚¨ãƒ©ãƒ¼
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `internal/runner/config/allowlist_test.go`

**è¦‹ç©æ™‚é–“**: 1æ™‚é–“

---

#### ãƒ†ã‚¹ãƒˆ4: `TestAllowlistViolation_ProcessEnv`

**ç›®çš„**: envå€¤ãŒç¦æ­¢ã•ã‚ŒãŸå¤‰æ•°ã‚’å‚ç…§ã§ããªã„ã“ã¨ã‚’æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. è¨±å¯ã•ã‚ŒãŸå†…éƒ¨å¤‰æ•°ã‚’å‚ç…§ã™ã‚‹env
   vars: [["myvar", "value"]]
   env: [["MY_ENV", "%{myvar}"]]
   æœŸå¾…: æˆåŠŸ

2. è¨±å¯ã•ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ envã‹ã‚‰æ¥ãŸvarsã‚’å‚ç…§ã™ã‚‹env
   from_env: [["safe", "HOME"]]
   env_allowlist: ["HOME"]
   env: [["MY_ENV", "%{safe}"]]
   æœŸå¾…: æˆåŠŸ

3. ã‚·ã‚¹ãƒ†ãƒ envã‚’ç›´æ¥å‚ç…§ã—ã‚ˆã†ã¨ã™ã‚‹env(å±•é–‹ã§å¤±æ•—ã™ã¹ã)
   env: [["MY_ENV", "%{HOME}"]]
   æœŸå¾…: æœªå®šç¾©å¤‰æ•°ã‚¨ãƒ©ãƒ¼(HOMEã¯å†…éƒ¨varsã«ãªã„)

4. allowlistã‚’å°Šé‡ã™ã‚‹è¤‡é›‘ãªãƒã‚§ãƒ¼ãƒ³
   from_env: [["a", "HOME"]]
   vars: [["b", "%{a}/subdir"]]
   env: [["MY_ENV", "%{b}"]]
   env_allowlist: ["HOME"]
   æœŸå¾…: æˆåŠŸ
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `internal/runner/config/allowlist_test.go`

**è¦‹ç©æ™‚é–“**: 45åˆ†

---

#### ãƒ†ã‚¹ãƒˆ5: `TestAllowlistViolation_EdgeCases`

**ç›®çš„**: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã¨è¤‡é›‘ãªã‚·ãƒŠãƒªã‚ªã‚’ãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’å«ã‚€allowlist(ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å ´åˆ)
2. allowlistãƒãƒƒãƒãƒ³ã‚°ã®å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥
3. ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€allowlist
4. éå¸¸ã«é•·ã„allowlist(ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹)
5. globalã¨groupã®é–“ã§allowlistãŒå¤‰æ›´ã•ã‚Œã‚‹
6. åŒã˜ã‚·ã‚¹ãƒ†ãƒ å¤‰æ•°ã‚’å‚ç…§ã™ã‚‹è¤‡æ•°ã®from_env
7. å¾ªç’°allowlistã®å½±éŸ¿(ã‚‚ã—ã‚ã‚Œã°)
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `internal/runner/config/allowlist_test.go`

**è¦‹ç©æ™‚é–“**: 30åˆ†

---

### å®Ÿè£…ã‚¬ã‚¤ãƒ‰

**ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ **:
```
internal/runner/config/
  allowlist_test.go  (æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«)
```

**ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³**:
```go
func TestAllowlistViolation_Global(t *testing.T) {
    tests := []struct {
        name        string
        fromEnv     [][]string
        allowlist   []string
        expectError bool
        errorMatch  string // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³
    }{
        {
            name: "è¨±å¯ã•ã‚ŒãŸå¤‰æ•°",
            fromEnv: [][]string{{"SAFE_VAR", "HOME"}},
            allowlist: []string{"HOME", "USER"},
            expectError: false,
        },
        {
            name: "ç¦æ­¢ã•ã‚ŒãŸå¤‰æ•°",
            fromEnv: [][]string{{"DANGER", "SECRET_KEY"}},
            allowlist: []string{"HOME", "USER"},
            expectError: true,
            errorMatch: "not in allowlist",
        },
        // ... ãã®ä»–ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            // ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
            t.Setenv("HOME", "/home/test")
            t.Setenv("SECRET_KEY", "secret")

            // configã‚’ä½œæˆ
            cfg := &runnertypes.GlobalConfig{
                FromEnv: tt.fromEnv,
                EnvAllowlist: tt.allowlist,
            }

            // å±•é–‹ã‚’å®Ÿè¡Œ
            err := config.ProcessGlobalFromEnv(cfg, envVars)

            // ã‚¢ã‚µãƒ¼ãƒˆ
            if tt.expectError {
                require.Error(t, err)
                if tt.errorMatch != "" {
                    require.Regexp(t, tt.errorMatch, err.Error())
                }
            } else {
                require.NoError(t, err)
            }
        })
    }
}
```

**ä¾å­˜é–¢ä¿‚**:
- ç¾åœ¨ã®`ProcessGlobalFromEnv`ã€`ProcessGroupFromEnv`é–¢æ•°ã‚’ä½¿ç”¨
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§%{VAR}æ§‹æ–‡ã‚’ä½¿ç”¨
- ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«`t.Setenv()`ã‚’ä½¿ç”¨

**æ¤œè¨¼**:
- ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- `-race`ãƒ•ãƒ©ã‚°ã§å®Ÿè¡Œ
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ˜ç¢ºã§å®Ÿç”¨çš„ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
- `go test -cover`ã§ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¤œè¨¼

---

## ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«å„ªå…ˆåº¦: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çµ±åˆãƒ†ã‚¹ãƒˆ

### ã‚®ãƒ£ãƒƒãƒ—åˆ†æ

**å‰Šé™¤ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆ**:
- `TestSecurityIntegration` (expansion_test.go)
- `TestSecurityAttackPrevention` (expansion_test.go)
- `TestRunner_SecurityIntegration` (runner_test.go)

**ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸**: âŒ **ãªã—**

### ãªãœã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‹

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çµ±åˆãƒ†ã‚¹ãƒˆã¯ä»¥ä¸‹ã‚’æ¤œè¨¼:
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‹•ä½œ
- æ”»æ’ƒé˜²æ­¢ãƒ¡ã‚«ãƒ‹ã‚ºãƒ (ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ãªã©)
- å±•é–‹ä¸­ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•ŒãŒç¶­æŒã•ã‚Œã‚‹
- è¤‡æ•°ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ãŒæ­£ã—ãé€£æºã™ã‚‹

### æ¨å¥¨ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆ1: `TestSecurityIntegration_E2E`

**ç›®çš„**: ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. Allowlist + Redactionçµ±åˆ
   - è¨±å¯ã•ã‚ŒãŸenvã‹ã‚‰ã®å¤‰æ•°ã¯å‹•ä½œã™ã¹ã
   - æ©Ÿå¯†å€¤ã¯ãƒ­ã‚°ã§redactã•ã‚Œã‚‹ã¹ã
   - ã‚¨ãƒ©ãƒ¼ã¯æ©Ÿå¯†å€¤ã‚’æ¼ã‚‰ã•ãªã„ã¹ã

2. å¤‰æ•°å±•é–‹ + ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
   - å±•é–‹ã•ã‚ŒãŸãƒ‘ã‚¹ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ å¢ƒç•Œã‚’å°Šé‡
   - å¤‰æ•°å€¤ã‚’ä»‹ã—ãŸã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãªã—
   - å¤‰æ•°ã‚’ä»‹ã—ãŸãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ãªã—

3. from_env + allowlist + vars + envãƒã‚§ãƒ¼ãƒ³
   - from_envã¯allowlistã‚’å°Šé‡
   - varsã¯from_envã‚’å®‰å…¨ã«å‚ç…§å¯èƒ½
   - envã¯varsã‚’å®‰å…¨ã«å‚ç…§å¯èƒ½
   - ãƒã‚§ãƒ¼ãƒ³å…¨ä½“ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒç¶­æŒã•ã‚Œã‚‹

4. ç•°ãªã‚‹allowlistã‚’æŒã¤è¤‡æ•°ã®ã‚°ãƒ«ãƒ¼ãƒ—
   - ã‚°ãƒ«ãƒ¼ãƒ—Aã¯VAR_Aã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - ã‚°ãƒ«ãƒ¼ãƒ—Bã¯VAR_Bã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - ã‚°ãƒ«ãƒ¼ãƒ—Aã¯ã„ã‹ãªã‚‹æ‰‹æ®µã§ã‚‚VAR_Bã«ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `internal/runner/config/security_integration_test.go` (æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«)

**è¦‹ç©æ™‚é–“**: 2æ™‚é–“

---

#### ãƒ†ã‚¹ãƒˆ2: `TestSecurityAttackPrevention`

**ç›®çš„**: ä¸€èˆ¬çš„ãªæ”»æ’ƒãƒ™ã‚¯ãƒˆãƒ«ãŒé˜²æ­¢ã•ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. å¤‰æ•°ã‚’ä»‹ã—ãŸã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
   vars: [["cmd", "rm -rf /"]]
   cmd: "echo %{cmd}"
   æœŸå¾…: å®‰å…¨ã«å®Ÿè¡Œ(å±•é–‹ã¯è¡Œã‚ã‚Œã‚‹ãŒã€ã‚³ãƒãƒ³ãƒ‰ã¯å˜ãªã‚‹echo)

2. å¤‰æ•°ã‚’ä»‹ã—ãŸãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«
   vars: [["path", "../../etc/passwd"]]
   verify_files: ["/safe/dir/%{path}"]
   æœŸå¾…: ãƒ‘ã‚¹è§£æ±ºãŒã“ã‚Œã‚’å®‰å…¨ã«å‡¦ç†

3. Allowlistãƒã‚¤ãƒ‘ã‚¹è©¦è¡Œ
   - varsãƒã‚§ãƒ¼ãƒ³ã‚’ä»‹ã—ã¦ç¦æ­¢ã•ã‚ŒãŸå¤‰æ•°ã‚’é–“æ¥çš„ã«å‚ç…§ã—ã‚ˆã†ã¨ã™ã‚‹
   - è‡ªå‹•å¤‰æ•°ã‚’ä¸Šæ›¸ãã—ã‚ˆã†ã¨ã™ã‚‹
   - é¡ä¼¼ã—ãŸåå‰ã§allowlistã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹

4. ç’°å¢ƒå¤‰æ•°ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
   - ã‚·ã‚¹ãƒ†ãƒ envã«æ‚ªæ„ã®ã‚ã‚‹å€¤
   - å±•é–‹ãŒåŸ‹ã‚è¾¼ã¾ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãªã„ã“ã¨ã‚’æ¤œè¨¼
   - ç‰¹æ®Šæ–‡å­—ãŒå®‰å…¨ã«å‡¦ç†ã•ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼

5. Redactionãƒã‚¤ãƒ‘ã‚¹è©¦è¡Œ
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä»‹ã—ã¦æ©Ÿå¯†å€¤ã‚’æ¼ã‚‰ãã†ã¨ã™ã‚‹
   - å¤‰æ•°åã‚’ä»‹ã—ã¦æ¼ã‚‰ãã†ã¨ã™ã‚‹
   - å¾ªç’°å‚ç…§ã‚’ä»‹ã—ã¦æ¼ã‚‰ãã†ã¨ã™ã‚‹

6. äºˆç´„ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹é•å
   - __runner_*å¤‰æ•°ã‚’ä¸Šæ›¸ãã—ã‚ˆã†ã¨ã™ã‚‹
   - äºˆç´„ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§å¤‰æ•°ã‚’ä½œæˆã—ã‚ˆã†ã¨ã™ã‚‹
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `internal/runner/config/security_integration_test.go`

**è¦‹ç©æ™‚é–“**: 2-3æ™‚é–“

---

#### ãƒ†ã‚¹ãƒˆ3: `TestRunner_SecurityIntegration`

**ç›®çš„**: runnerãƒ¬ãƒ™ãƒ«ã§ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã‚’æŒã¤å®Œå…¨ãªconfig
   - from_envã€varsã€envã‚’æŒã¤configã‚’ãƒ­ãƒ¼ãƒ‰
   - allowlistãŒå¼·åˆ¶ã•ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼
   - redactionãŒrunnerã§å‹•ä½œã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼
   - æ©Ÿå¯†envã‚’æŒã¤ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
   - å‡ºåŠ›ãŒé©åˆ‡ã«redactã•ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼

2. ç•°ãªã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒã¤è¤‡æ•°ã®ã‚³ãƒãƒ³ãƒ‰
   - åˆ¶é™çš„ãªallowlistã‚’æŒã¤ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚³ãƒãƒ³ãƒ‰1
   - å¯›å®¹ãªallowlistã‚’æŒã¤ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚³ãƒãƒ³ãƒ‰2
   - ã‚³ãƒãƒ³ãƒ‰é–“ã®åˆ†é›¢ã‚’æ¤œè¨¼

3. ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãŒãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼
   - ã‚¨ãƒ©ãƒ¼ãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’æ„è­˜ã—ã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼
   - ãƒ­ã‚°ãŒæ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’æ¼ã‚‰ã•ãªã„ã“ã¨ã‚’æ¤œè¨¼
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `internal/runner/runner_security_test.go` (æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«)

**è¦‹ç©æ™‚é–“**: 1-2æ™‚é–“

---

### å®Ÿè£…å„ªå…ˆåº¦

1. **TestSecurityIntegration_E2E** - æœ€é«˜å„ªå…ˆåº¦
2. **TestSecurityAttackPrevention** - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼ã«é‡è¦
3. **TestRunner_SecurityIntegration** - ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯æ¤œè¨¼ã«é‡è¦

---

## ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«å„ªå…ˆåº¦: ç’°å¢ƒå¤‰æ•°å„ªå…ˆé †ä½E2Eãƒ†ã‚¹ãƒˆ

### ã‚®ãƒ£ãƒƒãƒ—åˆ†æ

**å‰Šé™¤ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆ** (runner_test.go):
- `TestRunner_EnvironmentVariablePriority`
- `TestRunner_EnvironmentVariablePriority_CurrentImplementation`
- `TestRunner_EnvironmentVariablePriority_EdgeCases`
- `TestRunner_resolveEnvironmentVars`

**ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸**: âŒ **ãªã—** E2Eãƒ¬ãƒ™ãƒ«ã§

### ãªãœã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‹

ç’°å¢ƒå¤‰æ•°ã®å„ªå…ˆé †ä½ã¯æ­£ã—ã„å‹•ä½œã®**åŸºæœ¬**:
- å„ªå…ˆé †ä½: command env > group env > global env > system env
- é–“é•ã£ãŸå„ªå…ˆé †ä½ = æœ¬ç•ªç’°å¢ƒã§é–“é•ã£ãŸå¤‰æ•°å€¤
- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ /E2Eãƒ¬ãƒ™ãƒ«ã§ãƒ†ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹(ãƒ¦ãƒ‹ãƒƒãƒˆãƒ¬ãƒ™ãƒ«ã ã‘ã§ã¯ãªã„)
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã¯å¾®å¦™ãªãƒã‚°ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§

### æ¨å¥¨ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆ1: `TestRunner_EnvironmentVariablePriority_Basic`

**ç›®çš„**: åŸºæœ¬çš„ãªå„ªå…ˆé †ä½ãƒ«ãƒ¼ãƒ«ã‚’æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. ã‚·ã‚¹ãƒ†ãƒ envã®ã¿
   System: HOME=/home/system
   Global: (ãªã—)
   Group: (ãªã—)
   Command: (ãªã—)
   æœŸå¾…: HOME=/home/system

2. GlobalãŒsystemã‚’ä¸Šæ›¸ã
   System: HOME=/home/system
   Global: env=[["HOME", "/home/global"]]
   Group: (ãªã—)
   Command: (ãªã—)
   æœŸå¾…: HOME=/home/global

3. GroupãŒglobalã‚’ä¸Šæ›¸ã
   System: HOME=/home/system
   Global: env=[["HOME", "/home/global"]]
   Group: env=[["HOME", "/home/group"]]
   Command: (ãªã—)
   æœŸå¾…: HOME=/home/group

4. CommandãŒã™ã¹ã¦ã‚’ä¸Šæ›¸ã
   System: HOME=/home/system
   Global: env=[["HOME", "/home/global"]]
   Group: env=[["HOME", "/home/group"]]
   Command: env=[["HOME", "/home/command"]]
   æœŸå¾…: HOME=/home/command

5. æ··åˆå„ªå…ˆé †ä½
   System: A=sys_a, B=sys_b, C=sys_c
   Global: env=[["B", "global_b"]]
   Group: env=[["C", "group_c"]]
   Command: (ãªã—)
   æœŸå¾…: A=sys_a, B=global_b, C=group_c
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `cmd/runner/integration_test.go` (E2Eãƒ†ã‚¹ãƒˆ)

**è¦‹ç©æ™‚é–“**: 1.5æ™‚é–“

---

#### ãƒ†ã‚¹ãƒˆ2: `TestRunner_EnvironmentVariablePriority_WithVars`

**ç›®çš„**: varså±•é–‹ã‚’ä¼´ã†å„ªå…ˆé †ä½ã‚’æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. ä¸‹ä½å„ªå…ˆåº¦envã‚’å‚ç…§ã™ã‚‹vars
   Global: vars=[["myvar", "%{USER}"]]
           env=[["HOME", "%{myvar}"]]
   System: USER=testuser
   æœŸå¾…: HOME=testuser

2. commandã®varsãŒgroupã‚’ä¸Šæ›¸ã
   Global: vars=[["v", "global"]]
   Group: vars=[["v", "group"]]
   Command: vars=[["v", "command"]]
            env=[["RESULT", "%{v}"]]
   æœŸå¾…: RESULT=command

3. å„ªå…ˆé †ä½ã‚’å°Šé‡ã™ã‚‹è¤‡é›‘ãªãƒã‚§ãƒ¼ãƒ³
   Global: from_env=[["gvar", "HOME"]]
           vars=[["gv2", "%{gvar}/global"]]
   Group: vars=[["gv3", "%{gv2}/group"]]
   Command: env=[["FINAL", "%{gv3}/cmd"]]
   System: HOME=/home/test
   æœŸå¾…: FINAL=/home/test/global/group/cmd
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `cmd/runner/integration_test.go`

**è¦‹ç©æ™‚é–“**: 1æ™‚é–“

---

#### ãƒ†ã‚¹ãƒˆ3: `TestRunner_EnvironmentVariablePriority_EdgeCases`

**ç›®çš„**: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã¨ç•°å¸¸ãªã‚·ãƒŠãƒªã‚ªã‚’ãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
```go
// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. ç•°ãªã‚‹ãƒ¬ãƒ™ãƒ«ã§ã®ç©ºå€¤
   Global: env=[["VAR", ""]]
   Group: (VARã¯è¨­å®šã•ã‚Œã¦ã„ãªã„)
   æœŸå¾…: VAR="" (ç©ºã€æœªè¨­å®šã§ã¯ãªã„)

2. ã‚ˆã‚Šé«˜ã„å„ªå…ˆåº¦ã§æœªè¨­å®š
   Global: env=[["VAR", "global_value"]]
   Group: (VARã¯è¨­å®šã•ã‚Œã¦ã„ãªã„)
   æœŸå¾…: VAR=global_value (ä¸Šæ›¸ãã•ã‚Œãªã„)

3. æ•°å€¤ã¨ç‰¹æ®Šå€¤
   Command: env=[["NUM", "123"], ["SPECIAL", "$pecial!@#"]]
   æœŸå¾…: æ­£ç¢ºã«ä¿æŒã•ã‚Œã‚‹

4. éå¸¸ã«é•·ã„å€¤
   Command: env=[["LONG", "<4KBæ–‡å­—åˆ—>"]]
   æœŸå¾…: æ­£ç¢ºã«ä¿æŒã•ã‚Œã‚‹

5. å¤šãã®å¤‰æ•°(ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹/æ­£ç¢ºæ€§)
   å„ãƒ¬ãƒ™ãƒ«ã§50ä»¥ä¸Šã®å¤‰æ•°
   æœŸå¾…: ã™ã¹ã¦æ­£ã—ã„å„ªå…ˆé †ä½ã§æ­£ã—ãè§£æ±º

6. ãƒ¬ãƒ™ãƒ«é–“ã®å¾ªç’°å‚ç…§è©¦è¡Œ
   Global: vars=[["A", "%{B}"]]
   Group: vars=[["B", "%{A}"]]
   æœŸå¾…: ã‚¨ãƒ©ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã‚‹
```

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `cmd/runner/integration_test.go`

**è¦‹ç©æ™‚é–“**: 1æ™‚é–“

---

#### ãƒ†ã‚¹ãƒˆ4: `TestRunner_ResolveEnvironmentVars_Integration`

**ç›®çš„**: å¤‰æ•°è§£æ±ºã®çµ±åˆãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `cmd/runner/integration_test.go`

**è¦‹ç©æ™‚é–“**: 30åˆ†

---

### å®Ÿè£…ã‚¬ã‚¤ãƒ‰

**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `cmd/runner/integration_test.go` (æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ )

**ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³** (E2Eã‚¹ã‚¿ã‚¤ãƒ«):
```go
func TestRunner_EnvironmentVariablePriority_Basic(t *testing.T) {
    tests := []struct {
        name           string
        systemEnv      map[string]string
        globalEnv      [][]string
        groupEnv       [][]string
        commandEnv     [][]string
        expectedEnv    map[string]string
    }{
        {
            name: "commandãŒã™ã¹ã¦ã‚’ä¸Šæ›¸ã",
            systemEnv: map[string]string{"HOME": "/home/system"},
            globalEnv: [][]string{{"HOME", "/home/global"}},
            groupEnv: [][]string{{"HOME", "/home/group"}},
            commandEnv: [][]string{{"HOME", "/home/command"}},
            expectedEnv: map[string]string{"HOME": "/home/command"},
        },
        // ... ãã®ä»–ã®ã‚±ãƒ¼ã‚¹
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            // ã‚·ã‚¹ãƒ†ãƒ envã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
            for k, v := range tt.systemEnv {
                t.Setenv(k, v)
            }

            // configã‚’ä½œæˆ
            cfg := createTestConfig(tt.globalEnv, tt.groupEnv, tt.commandEnv)

            // configã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œ
            // (ã“ã‚Œã¯E2Eãªã®ã§ã€å®Ÿéš›ã®runnerã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨)
            runner, err := NewRunner(cfg)
            require.NoError(t, err)

            result, err := runner.ExecuteCommand(ctx, "printenv")
            require.NoError(t, err)

            // ç’°å¢ƒã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦æ¤œè¨¼
            actualEnv := parseEnvOutput(result.Stdout)
            for k, expectedV := range tt.expectedEnv {
                assert.Equal(t, expectedV, actualEnv[k], "å¤‰æ•° %s", k)
            }
        })
    }
}
```

---

## å®Ÿè£…ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³

### é€±1: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ

**1-2æ—¥ç›®** (6-8æ™‚é–“):
- [ ] Allowlistå¼·åˆ¶ãƒ†ã‚¹ãƒˆ(å…¨5ãƒ†ã‚¹ãƒˆ)
- [ ] åŸºæœ¬çš„ãªã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆ

**3-4æ—¥ç›®** (8-10æ™‚é–“):
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çµ±åˆãƒ†ã‚¹ãƒˆ(å…¨3ãƒ†ã‚¹ãƒˆ)
- [ ] æ”»æ’ƒé˜²æ­¢æ¤œè¨¼

**5æ—¥ç›®** (6-8æ™‚é–“):
- [ ] ç’°å¢ƒå¤‰æ•°å„ªå…ˆé †ä½E2Eãƒ†ã‚¹ãƒˆ(å…¨4ãƒ†ã‚¹ãƒˆ)
- [ ] çµ±åˆæ¤œè¨¼

**é€±1åˆè¨ˆ**: 20-26æ™‚é–“

### é€±2: é«˜å„ªå…ˆåº¦ãƒ†ã‚¹ãƒˆ(ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã ãŒæ¨å¥¨)

**1-2æ—¥ç›®** (4-6æ™‚é–“):
- [ ] ã‚³ãƒãƒ³ãƒ‰envå±•é–‹ãƒ†ã‚¹ãƒˆ
- [ ] Verify fileså±•é–‹ãƒ†ã‚¹ãƒˆ

**3æ—¥ç›®** (2-3æ™‚é–“):
- [ ] è‡ªå·±å‚ç…§ãƒ†ã‚¹ãƒˆ(æ™‚é–“ãŒã‚ã‚Œã°)

**é€±2åˆè¨ˆ**: 6-9æ™‚é–“

---

## æˆåŠŸåŸºæº–

### å®Œäº†ã®å®šç¾©

å„ãƒ†ã‚¹ãƒˆã«ã¤ã„ã¦:
- [ ] ãƒ†ã‚¹ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ãƒ‘ã‚¹ã—ã¦ã„ã‚‹
- [ ] ã™ã¹ã¦ã®æŒ‡å®šã•ã‚ŒãŸã‚·ãƒŠãƒªã‚ªã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹
- [ ] %{VAR}æ§‹æ–‡ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹(${VAR}ã§ã¯ãªã„)
- [ ] æ˜ç¢ºãªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚‹
- [ ] `-race`ãƒ•ãƒ©ã‚°ã§å•é¡Œãªãå®Ÿè¡Œã•ã‚Œã‚‹
- [ ] ç›®çš„ã¨ã‚·ãƒŠãƒªã‚ªãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] é–¢é€£é ˜åŸŸã®ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒå¢—åŠ ã—ã¦ã„ã‚‹

### æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ†ã‚¹ãƒˆå®Ÿè£…å¾Œ:
- [ ] å®Œå…¨ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’å®Ÿè¡Œ: `go test ./...`
- [ ] ãƒ¬ãƒ¼ã‚¹æ¤œå‡ºå™¨ã§å®Ÿè¡Œ: `go test -race ./...`
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ãƒã‚§ãƒƒã‚¯: `go test -cover ./...`
- [ ] ç‰¹å®šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ: `go test ./internal/runner/config/...`
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆã«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãŒãªã„ã“ã¨ã‚’æ¤œè¨¼
- [ ] ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚·ãƒŠãƒªã‚ªã®æ‰‹å‹•ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼

---

## å‚è€ƒè³‡æ–™

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**:
- `internal/runner/config/expansion_test.go` - ç¾åœ¨ã®å±•é–‹ãƒ†ã‚¹ãƒˆ
- `internal/runner/runner_test.go` - ç¾åœ¨ã®runnerãƒ†ã‚¹ãƒˆ
- `cmd/runner/integration_test.go` - çµ±åˆ/E2Eãƒ†ã‚¹ãƒˆ

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `internal/runner/config/expansion.go` - å±•é–‹ãƒ­ã‚¸ãƒƒã‚¯
- `internal/runner/config/loader.go` - Configèª­ã¿è¾¼ã¿
- `internal/runner/runner.go` - Runnerå®Ÿè£…

### Gitå‚ç…§

**ã‚­ãƒ¼ã‚³ãƒŸãƒƒãƒˆ**: `db64c21` - Switch config variable system to vars + %{VAR} syntax
**å‰ã®ã‚³ãƒŸãƒƒãƒˆ**: `db64c21~1` - å‰Šé™¤ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹

---

## å•ã„åˆã‚ã›

ã“ã‚Œã‚‰ã®æ¨å¥¨äº‹é …ã«é–¢ã™ã‚‹è³ªå•ã¯:
1. ãƒ†ã‚¹ãƒˆæ¤œè¨¼ã‚µãƒãƒªãƒ¼ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼
2. gitå±¥æ­´ã§å‰Šé™¤ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª
3. vars-envåˆ†é›¢è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§
4. é–‹ç™ºãƒãƒ¼ãƒ ã«é€£çµ¡

---

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**æœ€çµ‚æ›´æ–°**: 2025-10-15
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Ÿè£…æº–å‚™å®Œäº†

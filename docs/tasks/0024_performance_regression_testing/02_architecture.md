# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å›å¸°ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ  ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸå‰‡
- **ç›¸å¯¾æ¯”è¼ƒ**: åŒä¸€ç’°å¢ƒã§ã®PRå‰å¾Œæ¯”è¼ƒã«ã‚ˆã‚Šç’°å¢ƒä¾å­˜æ€§ã‚’æ’é™¤
- **çµ±è¨ˆçš„ä¿¡é ¼æ€§**: è¤‡æ•°å›æ¸¬å®šã«ã‚ˆã‚‹çµ±è¨ˆå‡¦ç†ã§æ¸¬å®šç²¾åº¦ã‚’å‘ä¸Š
- **è‡ªå‹•åŒ–**: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã®å®Œå…¨çµ±åˆ
- **æ‹¡å¼µæ€§**: æ–°ã—ã„ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯è¿½åŠ ãŒå®¹æ˜“ãªè¨­è¨ˆ

### 1.2 å…¨ä½“æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GitHub Actions CI                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Baselineæ¸¬å®š   â”‚â”€â”€â”€â–¶â”‚  Currentæ¸¬å®š    â”‚â”€â”€â”€â–¶â”‚  æ¯”è¼ƒãƒ»ãƒ¬ãƒãƒ¼ãƒˆ â”‚â”‚
â”‚  â”‚  (main branch)  â”‚    â”‚  (PR branch)    â”‚    â”‚  (regression)   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚           â”‚                       â”‚                       â”‚       â”‚
â”‚           â–¼                       â–¼                       â–¼       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚baseline.json    â”‚    â”‚current.json     â”‚    â”‚report.md        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   PR Comment    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 2.1 æ¸¬å®šã‚¨ãƒ³ã‚¸ãƒ³ (Measurement Engine)

#### 2.1.1 å½¹å‰²
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
- æ¸¬å®šãƒ‡ãƒ¼ã‚¿ã®åé›†ãƒ»çµ±è¨ˆå‡¦ç†
- çµæœã®JSONå‡ºåŠ›

#### 2.1.2 å†…éƒ¨æ§‹é€ 
```go
type MeasurementEngine struct {
    benchmarks []Benchmark
    iterations int
    warmup     int
}

type Benchmark struct {
    Name      string
    Operation func() error
    Category  string
}

type MeasurementResult struct {
    Metadata    ResultMetadata       `json:"metadata"`
    Benchmarks  map[string]BenchData `json:"benchmarks"`
}

type BenchData struct {
    Measurements    []int64           `json:"measurements_ns"`
    MedianNs        int64             `json:"median_ns"`
    P95Ns           int64             `json:"p95_ns"`
    AllocatedBytes  int64             `json:"allocated_bytes"`
    Environment     EnvironmentInfo   `json:"environment"`
}
```

#### 2.1.3 çµ±è¨ˆå‡¦ç†
- **ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—**: 10å›å®Ÿè¡Œã§åˆæœŸåŒ–å‡¦ç†ã®å½±éŸ¿æ’é™¤
- **æœ¬æ¸¬å®š**: 20å›å®Ÿè¡Œã§çµ±è¨ˆçš„ã«å®‰å®šã—ãŸãƒ‡ãƒ¼ã‚¿åé›†
- **å¤–ã‚Œå€¤é™¤å»**: ä¸Šä¸‹10%ã®å€¤ã‚’é™¤å¤–
- **ä»£è¡¨å€¤ç®—å‡º**: ä¸­å¤®å€¤ã€95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«å€¤ã‚’ç®—å‡º

### 2.2 æ¯”è¼ƒã‚¨ãƒ³ã‚¸ãƒ³ (Comparison Engine)

#### 2.2.1 å½¹å‰²
- ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨ç¾åœ¨ã®æ¸¬å®šçµæœæ¯”è¼ƒ
- å›å¸°åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè¡Œ
- æ¯”è¼ƒçµæœãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ

#### 2.2.2 å†…éƒ¨æ§‹é€ 
```go
type ComparisonEngine struct {
    thresholds map[string]float64
    config     ComparisonConfig
}

type ComparisonResult struct {
    Overall    OverallResult            `json:"overall"`
    Benchmarks map[string]BenchComparison `json:"benchmarks"`
    Summary    ComparisonSummary        `json:"summary"`
}

type BenchComparison struct {
    Baseline       BenchData    `json:"baseline"`
    Current        BenchData    `json:"current"`
    TimeRatio      float64      `json:"time_ratio"`
    MemoryRatio    float64      `json:"memory_ratio"`
    Status         string       `json:"status"` // PASS, WARN, FAIL
    Message        string       `json:"message"`
}
```

#### 2.2.3 åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
- **PASS**: å®Ÿè¡Œæ™‚é–“æ¯”ç‡ < 1.2å€ ã‹ã¤ ãƒ¡ãƒ¢ãƒªæ¯”ç‡ < 1.2å€
- **WARN**: å®Ÿè¡Œæ™‚é–“æ¯”ç‡ < 1.5å€ ã‹ã¤ ãƒ¡ãƒ¢ãƒªæ¯”ç‡ < 1.5å€
- **FAIL**: å®Ÿè¡Œæ™‚é–“æ¯”ç‡ â‰¥ 1.5å€ ã¾ãŸã¯ ãƒ¡ãƒ¢ãƒªæ¯”ç‡ â‰¥ 1.5å€

### 2.3 ãƒ¬ãƒãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ (Report Engine)

#### 2.3.1 å½¹å‰²
- Markdownå½¢å¼ã®ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- PRã‚³ãƒ¡ãƒ³ãƒˆç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- é–‹ç™ºè€…å‘ã‘ã®åˆ†ã‹ã‚Šã‚„ã™ã„è¡¨ç¤º

#### 2.3.2 ãƒ¬ãƒãƒ¼ãƒˆæ§‹é€ 
```markdown
# ğŸš€ Performance Regression Report

## Summary
- **Overall Status**: PASS/WARN/FAIL
- **Total Benchmarks**: N
- **Regressions Detected**: N

## Benchmark Results
| Benchmark | Baseline | Current | Ratio | Status |
|-----------|----------|---------|-------|--------|
| encode_simple_path | 201ns | 245ns | 1.22x | âš ï¸ WARN |

## Details
[è©³ç´°ãªåˆ†æçµæœ]
```

### 2.4 CIçµ±åˆãƒ¬ã‚¤ãƒ¤ãƒ¼ (CI Integration Layer)

#### 2.4.1 å½¹å‰²
- GitHub Actionsã¨ã®çµ±åˆ
- ãƒ–ãƒ©ãƒ³ãƒåˆ‡ã‚Šæ›¿ãˆåˆ¶å¾¡
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### 2.4.2 ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```yaml
name: Performance Regression Check
on:
  pull_request:
    paths: ['internal/filevalidator/encoding/**']

jobs:
  performance-check:
    steps:
      - name: Checkout
      - name: Setup Go
      - name: Measure Baseline (main)
      - name: Measure Current (PR)
      - name: Compare Results
      - name: Post PR Comment
```

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

### 3.1 æ¸¬å®šãƒ•ã‚§ãƒ¼ã‚º
```
å…¥åŠ›: ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚³ãƒ¼ãƒ‰
  â†“
[ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—å®Ÿè¡Œ] Ã— 10å›
  â†“
[æœ¬æ¸¬å®š] Ã— 20å›
  â†“
[çµ±è¨ˆå‡¦ç†] â†’ ä¸­å¤®å€¤ã€P95ç®—å‡º
  â†“
[ãƒ¡ãƒ¢ãƒªæ¸¬å®š] â†’ å‰²ã‚Šå½“ã¦é‡è¨ˆæ¸¬
  â†“
å‡ºåŠ›: JSONæ¸¬å®šçµæœ
```

### 3.2 æ¯”è¼ƒãƒ•ã‚§ãƒ¼ã‚º
```
å…¥åŠ›: baseline.json + current.json
  â†“
[ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ»æ¤œè¨¼]
  â†“
[ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯æ¯æ¯”è¼ƒ]
  â†“
[é–¾å€¤åˆ¤å®š]
  â†“
[ç·åˆåˆ¤å®š]
  â†“
å‡ºåŠ›: æ¯”è¼ƒçµæœ + Markdownãƒ¬ãƒãƒ¼ãƒˆ
```

## 4. è¨­å®šç®¡ç†

### 4.1 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 
```yaml
# performance-config.yaml
measurement:
  iterations: 20
  warmup: 10
  timeout: "5m"

thresholds:
  time_ratio:
    warn: 1.2
    fail: 1.5
  memory_ratio:
    warn: 1.2
    fail: 1.5

benchmarks:
  - name: "encode_simple_path"
    category: "encoding"
    enabled: true
  - name: "encode_with_fallback_normal"
    category: "encoding"
    enabled: true
```

### 4.2 ç’°å¢ƒåˆ¥è¨­å®š
- **ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ**: è©³ç´°ãƒ­ã‚°ã€é•·æ™‚é–“æ¸¬å®š
- **CIç’°å¢ƒ**: ç°¡æ½”ãƒ­ã‚°ã€æ™‚é–“åˆ¶é™
- **æœ¬ç•ªç’°å¢ƒ**: ã‚¨ãƒ©ãƒ¼æ™‚å³åº§åœæ­¢

## 5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 5.1 æ¸¬å®šã‚¨ãƒ©ãƒ¼
- **ç—‡çŠ¶**: ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œå¤±æ•—
- **å¯¾ç­–**: ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¸¬å®š

### 5.2 æ¯”è¼ƒã‚¨ãƒ©ãƒ¼
- **ç—‡çŠ¶**: ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä¸æ­£
- **å¯¾ç­–**: ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã€ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ

### 5.3 CIç’°å¢ƒã‚¨ãƒ©ãƒ¼
- **ç—‡çŠ¶**: ãƒ–ãƒ©ãƒ³ãƒåˆ‡ã‚Šæ›¿ãˆå¤±æ•—
- **å¯¾ç­–**: æ¨©é™ç¢ºèªã€è©³ç´°ãƒ­ã‚°å‡ºåŠ›

## 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 6.1 ãƒ‡ãƒ¼ã‚¿ä¿è­·
- æ¸¬å®šãƒ‡ãƒ¼ã‚¿ã«æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œãªã„ã“ã¨ã‚’ä¿è¨¼
- ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®é©åˆ‡ãªå‰Šé™¤

### 6.2 æ¨©é™ç®¡ç†
- mainãƒ–ãƒ©ãƒ³ãƒã¸ã®èª­ã¿å–ã‚Šå°‚ç”¨ã‚¢ã‚¯ã‚»ã‚¹
- PRã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿æ¨©é™ã®åˆ¶é™

## 7. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

### 7.1 æ¸¬å®šç²¾åº¦ vs å®Ÿè¡Œæ™‚é–“
- æ¸¬å®šå›æ•°: ç²¾åº¦ã¨CIæ™‚é–“ã®ãƒãƒ©ãƒ³ã‚¹
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: ç•°å¸¸ãªé•·æ™‚é–“å®Ÿè¡Œã®é˜²æ­¢

### 7.2 ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: å¤§é‡æ¸¬å®šãƒ‡ãƒ¼ã‚¿ã®åŠ¹ç‡çš„å‡¦ç†
- CPUä½¿ç”¨é‡: CIç’°å¢ƒã§ã®ä»–ã‚¸ãƒ§ãƒ–ã¸ã®å½±éŸ¿æœ€å°åŒ–

## 8. å°†æ¥æ‹¡å¼µæ€§

### 8.1 ä»–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¯¾å¿œ
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿæ§‹ã«ã‚ˆã‚‹æ–°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ 
- å…±é€šæ¸¬å®šã‚¤ãƒ³ãƒ•ãƒ©ã®å†åˆ©ç”¨

### 8.2 é«˜åº¦ãªåˆ†ææ©Ÿèƒ½
- æ€§èƒ½ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
- å›å¸°åŸå› ã®è‡ªå‹•åˆ†æ
- æœ€é©åŒ–ææ¡ˆæ©Ÿèƒ½

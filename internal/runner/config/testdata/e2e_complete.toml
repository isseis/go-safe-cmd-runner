# E2E Complete Test Configuration
# Tests all aspects of Global/Group/Command level environment variables
# with allowlist inheritance and complex variable references

[global]
env = [
    "BASE_DIR=/opt/app",
    "LOG_LEVEL=info",
    "PATH=/opt/tools/bin:${PATH}"
]
env_allowlist = ["HOME", "USER", "PATH"]
verify_files = ["${BASE_DIR}/verify.sh"]

[[groups]]
name = "database"
env = [
    "DB_HOST=localhost",
    "DB_PORT=5432",
    "DB_DATA=${BASE_DIR}/db-data"
]
verify_files = ["${DB_DATA}/schema.sql"]

[[groups.commands]]
name = "migrate"
cmd = "${BASE_DIR}/bin/migrate"
args = ["-h", "${DB_HOST}", "-p", "${DB_PORT}"]
env = ["MIGRATION_DIR=${DB_DATA}/migrations"]

[[groups]]
name = "web"
env_allowlist = ["PORT"]  # Override: only PORT allowed
env = ["WEB_DIR=${BASE_DIR}/web"]

[[groups.commands]]
name = "start"
cmd = "${WEB_DIR}/server"
args = ["--port", "${PORT}"]
